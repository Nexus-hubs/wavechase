<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Chase - Global Weather & Wave Conditions</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #0d1b2a 50%, #1b263b 100%);
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Hero Section with Beach Background */
        .hero {
            position: relative;
            min-height: 100vh;
            background: linear-gradient(rgba(10, 22, 40, 0.85), rgba(13, 27, 42, 0.90)),
                        url('https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=1920&q=80') center/cover;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(30, 58, 138, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(37, 99, 235, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            width: 100%;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
        }

        h1 {
            font-size: 4em;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 15px;
            letter-spacing: -1px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tagline {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Elegant Search Card */
        .search-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease;
        }

        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            min-width: 250px;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            font-size: 1em;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            outline: none;
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        input[type="text"]:focus {
            background: rgba(255, 255, 255, 0.18);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        /* Clean Modern Buttons */
        button {
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 64, 175, 0.4);
        }

        .btn-secondary {
            background: #1e3a8a;
            color: white;
        }

        .btn-secondary:hover {
            background: #1e293b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }

        .btn-success {
            background: #2563eb;
            color: white;
        }

        .btn-success:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }

        .btn-warning {
            background: #dc2626;
            color: white;
        }

        .btn-warning:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }

        /* Quick Search Pills */
        .quick-search {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .quick-search h3 {
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
        }

        .location-chip {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .location-chip:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            color: #ffffff;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 50px 20px;
            margin: 30px 0;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            margin: 0 auto 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Results Section */
        .results-section {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin: 40px 0;
            animation: fadeInUp 0.7s ease;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            margin-bottom: 35px;
            text-align: center;
        }

        .results-header h2 {
            font-size: 2.2em;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .location-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1em;
            font-weight: 400;
        }

        /* Current Conditions - Compact Cards */
        .current-conditions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .condition-card {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .condition-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #1e40af, #2563eb);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .condition-card:hover::before {
            transform: scaleX(1);
        }

        .condition-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-4px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .condition-card h3 {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .condition-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .condition-unit {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        /* Forecast Section */
        .forecast-section {
            margin-top: 35px;
        }

        .forecast-section h3 {
            font-size: 1.6em;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
            color: #ffffff;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
        }

        .forecast-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 12px;
            padding: 18px 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .forecast-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .forecast-time {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .forecast-wave {
            font-size: 1.6em;
            font-weight: 700;
            color: #ffffff;
            margin: 8px 0;
        }

        .forecast-detail {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.5);
            margin: 3px 0;
        }

        /* Error Message */
        .error-message {
            display: none;
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: #fca5a5;
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .error-message.active {
            display: block;
        }

        /* Surfboard & Beach Decorations */
        .surfboard-img {
            position: fixed;
            opacity: 0.25;
            pointer-events: none;
            z-index: 0;
            filter: brightness(1.1);
        }

        .surfboard-1 {
            width: 180px;
            top: 12%;
            right: 6%;
            transform: rotate(40deg);
        }

        .surfboard-2 {
            width: 140px;
            bottom: 18%;
            left: 4%;
            transform: rotate(-35deg);
        }

        .beach-wave {
            position: fixed;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            filter: brightness(1.2);
        }

        .wave-1 {
            width: 250px;
            top: 50%;
            right: -50px;
            transform: rotate(15deg);
        }

        .wave-2 {
            width: 200px;
            bottom: 10%;
            left: -30px;
            transform: rotate(-20deg);
        }

        /* Storm Watch Section */
        .storm-section {
            background: rgba(220, 38, 38, 0.1);
            padding: 60px 20px;
            margin-top: 50px;
            border-top: 2px solid rgba(220, 38, 38, 0.3);
        }

        .storm-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .storm-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .storm-header h2 {
            font-size: 2.5em;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .storm-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1em;
        }

        .storm-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .storm-tool-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .storm-tool-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-8px);
        }

        .storm-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .storm-tool-card h3 {
            font-size: 1.4em;
            color: #ffffff;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .storm-tool-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .storm-tool-card button {
            width: 100%;
        }

        /* Storm Data Display */
        .storm-data-section {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-top: 30px;
            animation: fadeInUp 0.7s ease;
        }

        .storm-data-section.active {
            display: block;
        }

        .storm-alerts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .alert-card {
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .alert-card:hover {
            background: rgba(220, 38, 38, 0.25);
            transform: scale(1.02);
        }

        .alert-card h4 {
            color: #fca5a5;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .alert-card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            line-height: 1.5;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            font-weight: 300;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-25px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(25px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.8em;
            }

            .tagline {
                font-size: 1em;
            }

            .search-card {
                padding: 25px 18px;
            }

            .search-box {
                flex-direction: column;
            }

            input[type="text"] {
                min-width: 100%;
                font-size: 0.95em;
            }

            button {
                width: 100%;
                padding: 14px 24px;
            }

            .results-section {
                padding: 25px 18px;
            }

            .results-header h2 {
                font-size: 1.8em;
            }

            .location-info {
                font-size: 0.9em;
            }

            .surfboard-img, .beach-wave {
                display: none;
            }

            .current-conditions {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 12px;
            }

            .condition-card {
                padding: 20px 15px;
            }

            .condition-value {
                font-size: 2em;
            }

            .forecast-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                gap: 10px;
            }

            .forecast-item {
                padding: 15px 10px;
            }

            .forecast-wave {
                font-size: 1.4em;
            }

            .storm-section {
                padding: 40px 20px;
            }

            .storm-header h2 {
                font-size: 2em;
                flex-direction: column;
                gap: 10px;
            }

            .storm-tools {
                gap: 20px;
            }

            .storm-tool-card {
                padding: 25px;
            }

            .storm-data-section {
                padding: 25px 18px;
            }

            .location-chip {
                font-size: 0.85em;
                padding: 8px 16px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2.2em;
                letter-spacing: 0;
            }

            .current-conditions {
                grid-template-columns: repeat(2, 1fr);
            }

            .forecast-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .storm-tools {
                grid-template-columns: 1fr;
            }

            .storm-alerts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Surfboard Decorations -->
    <img src="https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=400&q=80" class="surfboard-img surfboard-1" alt="">
    <img src="https://images.unsplash.com/photo-1459262838948-3e2de6c1ec80?w=400&q=80" class="surfboard-img surfboard-2" alt="">

    <!-- Beach Wave Decorations -->
    <img src="https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=400&q=80" class="beach-wave wave-1" alt="">
    <img src="https://images.unsplash.com/photo-1520942702018-0862200e6873?w=400&q=80" class="beach-wave wave-2" alt="">

    <div class="hero">
        <div class="container">
            <header>
                <h1>WAVE CHASE</h1>
                <p class="tagline">Real-Time Wave Conditions Worldwide</p>
            </header>

            <div class="search-card">
                <div class="search-box">
                    <input type="text" id="locationInput" placeholder="Search any beach, coast or surf spot..." />
                    <button class="btn-success" onclick="fetchLiveData()"><span>üì° Live Data</span></button>
                    <button class="btn-primary" onclick="searchWeather()"><span>üå§Ô∏è Weather</span></button>
                    <button class="btn-secondary" onclick="searchWaves()"><span>üåä Waves</span></button>
                </div>

                <div class="quick-search">
                    <h3>Popular Surf Spots</h3>
                    <button class="location-chip" onclick="quickSearch('Pipeline, Hawaii')">Pipeline, HI</button>
                    <button class="location-chip" onclick="quickSearch('Malibu, California')">Malibu, CA</button>
                    <button class="location-chip" onclick="quickSearch('Bali, Indonesia')">Bali</button>
                    <button class="location-chip" onclick="quickSearch('Gold Coast, Australia')">Gold Coast</button>
                    <button class="location-chip" onclick="quickSearch('Jeffreys Bay, South Africa')">J-Bay</button>
                    <button class="location-chip" onclick="quickSearch('Hossegor, France')">Hossegor</button>
                    <button class="location-chip" onclick="quickSearch('Trestles, California')">Trestles</button>
                    <button class="location-chip" onclick="quickSearch('Teahupo\'o, Tahiti')">Teahupo'o</button>
                </div>
            </div>

            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p style="color: rgba(255,255,255,0.8); font-size: 1em;">Fetching wave data...</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <h2 id="resultsTitle">Wave Conditions</h2>
                    <p class="location-info" id="locationInfo"></p>
                </div>

                <div class="current-conditions" id="currentConditions">
                    <!-- Current conditions will be inserted here -->
                </div>

                <div class="forecast-section">
                    <h3>24-Hour Forecast</h3>
                    <div class="forecast-grid" id="forecastGrid">
                        <!-- Forecast items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Storm Watch Section -->
    <div class="storm-section">
        <div class="storm-container">
            <div class="storm-header">
                <h2>‚ö†Ô∏è STORM WATCH ‚ö†Ô∏è</h2>
                <p>Track severe weather conditions and marine alerts</p>
            </div>

            <div class="storm-tools">
                <div class="storm-tool-card" onclick="fetchStormData()">
                    <div class="storm-icon">üå™Ô∏è</div>
                    <h3>Weather Alerts</h3>
                    <p>Get real-time weather warnings, wind alerts, and severe storm notifications from API</p>
                    <button class="btn-warning"><span>Check Alerts</span></button>
                </div>

                <div class="storm-tool-card" onclick="searchStormReports()">
                    <div class="storm-icon">üì∞</div>
                    <h3>Storm Reports</h3>
                    <p>Search latest storm and hurricane reports, weather news, and marine warnings</p>
                    <button class="btn-primary"><span>Google Search</span></button>
                </div>

                <div class="storm-tool-card" onclick="openStormMap()">
                    <div class="storm-icon">üó∫Ô∏è</div>
                    <h3>Storm Tracking</h3>
                    <p>View live storm paths, radar maps, and weather patterns on Google Maps</p>
                    <button class="btn-secondary"><span>Open Maps</span></button>
                </div>
            </div>

            <div class="storm-data-section" id="stormDataSection">
                <h3 style="text-align: center; color: #fca5a5; font-size: 1.8em; margin-bottom: 25px;">Weather Alerts</h3>
                <div class="storm-alerts" id="stormAlerts">
                    <!-- Storm alerts will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Wave Chase | Powered by Open-Meteo Marine API & Google Search</p>
    </footer>

    <script>
        // Handle Enter key press in search input
        document.getElementById('locationInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                fetchLiveData();
            }
        });

        function getLocation() {
            const location = document.getElementById('locationInput').value.trim();
            if (!location) {
                showError('Please enter a location');
                return null;
            }
            return location;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
            setTimeout(() => {
                errorDiv.classList.remove('active');
            }, 5000);
        }

        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }

        // Geocoding function to convert location name to coordinates
        async function geocodeLocation(locationName) {
            const geocodeUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(locationName)}&count=1&language=en&format=json`;

            console.log('üåç Geocoding API Call:', geocodeUrl);

            try {
                const response = await fetch(geocodeUrl);
                const data = await response.json();

                console.log('üìç Geocoding Response:', data);

                if (data.results && data.results.length > 0) {
                    const coords = {
                        lat: data.results[0].latitude,
                        lon: data.results[0].longitude,
                        name: data.results[0].name,
                        country: data.results[0].country,
                        admin1: data.results[0].admin1
                    };
                    console.log('‚úÖ Coordinates found:', coords);
                    return coords;
                } else {
                    throw new Error('Location not found');
                }
            } catch (error) {
                console.error('‚ùå Geocoding error:', error);
                throw new Error('Failed to find location. Please try a different search term.');
            }
        }

        // Fetch wave data from Open-Meteo Marine API
        async function fetchWaveData(lat, lon) {
            const url = `https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lon}&hourly=wave_height,wind_wave_height,swell_wave_height,wave_direction,wave_period&timezone=auto&forecast_days=1`;

            console.log('üåä Marine API Call:', url);
            console.log('üìç Coordinates:', { lat, lon });

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to fetch wave data');
                }
                const data = await response.json();

                console.log('üåä Marine API Response:', data);
                console.log('üìä Wave heights (first 6 hours):', data.hourly.wave_height.slice(0, 6));
                console.log('üïí Times (first 6 hours):', data.hourly.time.slice(0, 6));

                return data;
            } catch (error) {
                console.error('‚ùå Marine API error:', error);
                throw new Error('Failed to fetch wave data from API');
            }
        }

        // Main function to fetch live data
        async function fetchLiveData() {
            const location = getLocation();
            if (!location) return;

            console.log('üöÄ Starting Live Data Fetch for:', location);

            showLoading(true);
            document.getElementById('resultsSection').classList.remove('active');

            try {
                // Step 1: Geocode the location
                console.log('üìç Step 1: Geocoding location...');
                const coords = await geocodeLocation(location);

                // Step 2: Fetch wave data
                console.log('üåä Step 2: Fetching wave data...');
                const waveData = await fetchWaveData(coords.lat, coords.lon);

                // Step 3: Display the results
                console.log('‚úÖ Step 3: Displaying results...');
                displayResults(coords, waveData);

                showLoading(false);
                console.log('üéâ Data fetch complete!');
            } catch (error) {
                console.error('‚ùå Error in fetchLiveData:', error);
                showLoading(false);
                showError(error.message);
            }
        }

        function displayResults(coords, waveData) {
            // Update location info
            const locationText = coords.admin1
                ? `${coords.name}, ${coords.admin1}, ${coords.country}`
                : `${coords.name}, ${coords.country}`;

            document.getElementById('resultsTitle').textContent = coords.name;
            document.getElementById('locationInfo').textContent = `${locationText} ‚Ä¢ ${coords.lat.toFixed(2)}¬∞, ${coords.lon.toFixed(2)}¬∞`;

            // Get current data (first hour)
            const currentIndex = 0;
            const currentWaveHeight = waveData.hourly.wave_height[currentIndex];
            const currentWindWave = waveData.hourly.wind_wave_height[currentIndex];
            const currentSwellWave = waveData.hourly.swell_wave_height[currentIndex];
            const currentDirection = waveData.hourly.wave_direction[currentIndex];
            const currentPeriod = waveData.hourly.wave_period[currentIndex];

            // Display current conditions
            const currentConditionsHTML = `
                <div class="condition-card">
                    <h3>Wave Height</h3>
                    <div class="condition-value">${currentWaveHeight.toFixed(1)}</div>
                    <div class="condition-unit">meters</div>
                </div>
                <div class="condition-card">
                    <h3>Wind Wave</h3>
                    <div class="condition-value">${currentWindWave.toFixed(1)}</div>
                    <div class="condition-unit">meters</div>
                </div>
                <div class="condition-card">
                    <h3>Swell</h3>
                    <div class="condition-value">${currentSwellWave.toFixed(1)}</div>
                    <div class="condition-unit">meters</div>
                </div>
                <div class="condition-card">
                    <h3>Direction</h3>
                    <div class="condition-value">${currentDirection}¬∞</div>
                    <div class="condition-unit">${getDirectionName(currentDirection)}</div>
                </div>
                <div class="condition-card">
                    <h3>Period</h3>
                    <div class="condition-value">${currentPeriod.toFixed(1)}</div>
                    <div class="condition-unit">seconds</div>
                </div>
            `;
            document.getElementById('currentConditions').innerHTML = currentConditionsHTML;

            // Display 24-hour forecast (every 3 hours for cleaner display)
            let forecastHTML = '';
            for (let i = 0; i < 24; i += 3) {
                const time = new Date(waveData.hourly.time[i]);
                const waveHeight = waveData.hourly.wave_height[i];
                const windWave = waveData.hourly.wind_wave_height[i];
                const swellWave = waveData.hourly.swell_wave_height[i];
                const direction = waveData.hourly.wave_direction[i];

                forecastHTML += `
                    <div class="forecast-item">
                        <div class="forecast-time">${formatTime(time)}</div>
                        <div class="forecast-wave">${waveHeight.toFixed(1)}m</div>
                        <div class="forecast-detail">Wind: ${windWave.toFixed(1)}m</div>
                        <div class="forecast-detail">Swell: ${swellWave.toFixed(1)}m</div>
                        <div class="forecast-detail">${getDirectionName(direction)}</div>
                    </div>
                `;
            }
            document.getElementById('forecastGrid').innerHTML = forecastHTML;

            // Show results section
            document.getElementById('resultsSection').classList.add('active');

            // Smooth scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function formatTime(date) {
            const hours = date.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:00 ${ampm}`;
        }

        function getDirectionName(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        function searchWeather() {
            const location = getLocation();
            if (!location) return;

            const searchQuery = `weather ${location} current conditions`;
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
            window.open(googleSearchUrl, '_blank');
        }

        function searchWaves() {
            const location = getLocation();
            if (!location) return;

            const searchQuery = `${location} surf report wave height swell forecast`;
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
            window.open(googleSearchUrl, '_blank');
        }

        function quickSearch(location) {
            document.getElementById('locationInput').value = location;
            fetchLiveData();
        }

        // Storm Watch Functions

        // Fetch storm and weather alert data from Open-Meteo API
        async function fetchStormData() {
            const location = getLocation();
            if (!location) {
                showError('Please enter a location to check for storm alerts');
                return;
            }

            console.log('‚ö†Ô∏è Starting Storm Data Fetch for:', location);

            showLoading(true);
            document.getElementById('stormDataSection').classList.remove('active');

            try {
                // Geocode the location
                const coords = await geocodeLocation(location);

                // Fetch weather data including wind and precipitation
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,wind_speed_10m,wind_gusts_10m,precipitation,weather_code&hourly=wind_speed_10m,wind_gusts_10m,precipitation_probability&timezone=auto&forecast_days=3`;

                console.log('üå™Ô∏è Weather Alert API Call:', weatherUrl);

                const response = await fetch(weatherUrl);
                const data = await response.json();

                console.log('‚ö†Ô∏è Weather Alert Response:', data);

                displayStormAlerts(coords, data);

                showLoading(false);
            } catch (error) {
                console.error('‚ùå Error in fetchStormData:', error);
                showLoading(false);
                showError(error.message);
            }
        }

        function displayStormAlerts(coords, weatherData) {
            const current = weatherData.current;
            const hourly = weatherData.hourly;

            // Analyze current conditions for warnings
            const alerts = [];

            // Wind alert
            if (current.wind_speed_10m > 20) {
                alerts.push({
                    title: '‚ö†Ô∏è High Wind Warning',
                    message: `Strong winds detected: ${current.wind_speed_10m.toFixed(1)} km/h with gusts up to ${current.wind_gusts_10m.toFixed(1)} km/h. Exercise caution near water.`
                });
            }

            // Precipitation alert
            if (current.precipitation > 5) {
                alerts.push({
                    title: 'üåßÔ∏è Heavy Precipitation Alert',
                    message: `Current precipitation: ${current.precipitation.toFixed(1)} mm. Poor visibility and rough sea conditions expected.`
                });
            }

            // Find max wind gusts in next 24 hours
            const maxWindGust = Math.max(...hourly.wind_gusts_10m.slice(0, 24));
            if (maxWindGust > 30) {
                alerts.push({
                    title: 'üí® Storm Warning - 24hr Forecast',
                    message: `Severe wind gusts up to ${maxWindGust.toFixed(1)} km/h expected in the next 24 hours. Dangerous marine conditions.`
                });
            }

            // Check precipitation probability
            const maxPrecipProb = Math.max(...hourly.precipitation_probability.slice(0, 24));
            if (maxPrecipProb > 70) {
                alerts.push({
                    title: '‚òî Rain Alert',
                    message: `High chance of precipitation (${maxPrecipProb}%) in the next 24 hours. Plan accordingly.`
                });
            }

            // Temperature extreme
            if (current.temperature_2m < 5) {
                alerts.push({
                    title: '‚ùÑÔ∏è Cold Weather Advisory',
                    message: `Current temperature: ${current.temperature_2m.toFixed(1)}¬∞C. Risk of hypothermia. Wear appropriate protection.`
                });
            }

            const locationText = coords.admin1
                ? `${coords.name}, ${coords.admin1}, ${coords.country}`
                : `${coords.name}, ${coords.country}`;

            // Display alerts
            let alertsHTML = '';

            if (alerts.length === 0) {
                alertsHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <div style="font-size: 4em; margin-bottom: 20px;">‚úÖ</div>
                        <h3 style="color: #4ade80; font-size: 1.5em; margin-bottom: 10px;">No Active Alerts</h3>
                        <p style="font-size: 1.1em;">Weather conditions are currently safe in ${locationText}</p>
                        <p style="margin-top: 15px; font-size: 0.95em;">Current: ${current.temperature_2m.toFixed(1)}¬∞C, Wind: ${current.wind_speed_10m.toFixed(1)} km/h</p>
                    </div>
                `;
            } else {
                alertsHTML = `<div style="text-align: center; margin-bottom: 25px; color: rgba(255,255,255,0.8);">
                    <p style="font-size: 1.1em;">${locationText}</p>
                    <p style="margin-top: 5px; font-size: 0.95em;">${alerts.length} active alert${alerts.length > 1 ? 's' : ''}</p>
                </div>`;

                alerts.forEach(alert => {
                    alertsHTML += `
                        <div class="alert-card">
                            <h4>${alert.title}</h4>
                            <p>${alert.message}</p>
                        </div>
                    `;
                });
            }

            document.getElementById('stormAlerts').innerHTML = alertsHTML;
            document.getElementById('stormDataSection').classList.add('active');

            // Smooth scroll to storm alerts
            document.getElementById('stormDataSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Google Search for storm reports
        function searchStormReports() {
            const location = getLocation();
            if (!location) {
                showError('Please enter a location to search storm reports');
                return;
            }

            const searchQuery = `${location} storm warning hurricane weather alert marine forecast`;
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
            window.open(googleSearchUrl, '_blank');
        }

        // Open Google Maps with weather layer for storm tracking
        function openStormMap() {
            const location = getLocation();
            if (!location) {
                showError('Please enter a location to view on maps');
                return;
            }

            // Google Maps URL with weather layer
            const mapsUrl = `https://www.google.com/maps/search/${encodeURIComponent(location)}`;
            window.open(mapsUrl, '_blank');
        }
    </script>
</body>
</html>
